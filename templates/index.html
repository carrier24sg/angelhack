<!DOCTYPE html>
<html lang="en">
<head>
  <title>Contest Page</title>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.min.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/utility.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/style-light.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/glyphicons.css">
  
  <script src="{{ STATIC_URL }}js/jquery.js"></script>
  <script src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
  <script src="{{ STATIC_URL }}js/underscore.js"></script>
  <script src="{{ STATIC_URL }}js/backbone.js"></script>  
  <script src="{{ STATIC_URL }}js/helper.js"></script>
  <script src="{{ STATIC_URL }}js/accounting.js"></script>
</head>
<body>
  <div class="container" id="wrapper">
    
    <div id="header"></div>



    <div class="row" id="developersContainer"></div> 
    <div class="row center">
      <button class="btn btn-primary" id="award">Award Winner</button>
    </div>
  </div>

  <script type="text/template" id="developer-template">
    <h2><%= capitalizeWords(model.name) %></h2>
    <img src= <%= model.src %> />
    <p> Score: <%= model.scoreGivenByCompany %></p>
  </script>
  
  <script type="text/template" id="comment-template">
    <span class="glyphicons activity-icon envelope"><i></i></span>
    <span class="ellipsis">
      <%= capitalizeWords(model.givenByName) %>
      <%= model.points > 0 ? "gave" : "took away" %> 
      <%= Math.abs(model.points) %> 
      <%= model.points > 1 ? "points" : "point" %> 
      for <%= model.category %> </p>
      <span class="meta glyphicons calendar single"><i></i> on <%= model.dateAdded %> </span>
    </span>
    <div class="clearfix"></div>      

  </script>  

  <script type="text/template" id="header-template">
    <h2>Task Description</h2>
    <p><%= model.task %> </p>
    <h2>Position</h2>
    <p><%= model.position %></h2>
  </script>  

  <script src="{{ STATIC_URL }}js/data.js"></script>
  <script src="{{ STATIC_URL }}js/models/developer.js"></script>
  <script src="{{ STATIC_URL }}js/models/comment.js"></script>
  <script src="{{ STATIC_URL }}js/models/company.js"></script>

  <script src="{{ STATIC_URL }}js/collections/developers.js"></script>
  <script src="{{ STATIC_URL }}js/collections/comments.js"></script>
  
  <script src="{{ STATIC_URL }}js/views/app.js"></script>
  <script src="{{ STATIC_URL }}js/views/company.js"></script>
  <script src="{{ STATIC_URL }}js/views/developers.js"></script>
  <script src="{{ STATIC_URL }}js/views/comments.js"></script>
  <script>
    $(function() {
      //console.log({{ user.id }})
      //console.log( {{ resource_url }} )

      new app.MainView();
      app.comments = new app.Comments();

      app.developers = new app.Developers(developersData);
      new app.DevelopersView({collection: app.developers});    

      candidatesNames = [$('.developer').eq(0).attr('data-name-id').split(',')[0], 
        $('.developer').eq(1).attr('data-name-id').split(',')[0]];
    
      candidatesIds = [$('.developer').eq(0).attr('data-name-id').split(',')[1], 
        $('.developer').eq(1).attr('data-name-id').split(',')[1]];      

      $('#award').click( function( event ) {
        $('#payDialog').dialog("open");
      });

      $('#payDialog').dialog({
        autoOpen: false,
        modal: true,
        width: 400,
        buttons: [
        { 
          text: capitalizeWords(candidatesNames[0]), 
          click: function() { 
            $(this).dialog('close');
            $('#hireDialog')
              .text('Do you would want to hire ' + capitalizeWords(candidatesNames[0]) + ' full-time as a ' + app.company.get('position') + '?');
            $('#hireDialog').dialog('open');
          }
        },
        {
          text: capitalizeWords(candidatesNames[1]),
          click: function() {
            $(this).dialog('close');
            $('#hireDialog')
              .text('Do you would want to hire ' + capitalizeWords(candidatesNames[1]) + ' full-time as a ' + app.company.get('position') + '?');        
            $('#hireDialog').dialog('open');
          }
        }]
      });

      $('#hireDialog').dialog({
        autoOpen: false,
        modal: true,
        width: 400,
        dialogClass: 'no-close',
        buttons: [
        { 
          text: "Yes", 
          click: function() { 
            app.company.calculateBill(true);
            $(this).dialog('close');
            $('#final').html(app.company.get('totalBillStatement')).dialog('open');
          }
        },
        {
          text: "No",
          click: function() {
            app.company.calculateBill(false);
            $(this).dialog('close');
            $('#final').html(app.company.get('totalBillStatement')).dialog('open');
          }
        }]
      });    

      $('#final').dialog({
        autoOpen: false,
        modal: true,
        width: 400,
        dialogClass: 'no-close',
        buttons: [
        { 
          text: "Okay!", 
          click: function() { 
            $(this).dialog('close');
            $('#award').addClass('disabled').unbind('click').text('Winner Awarded');
          }
        }]
      });   

    })
  </script>

  <div id="payDialog" title="Select the winner!">
    <p> 80% of the prize will be awarded to the winner, with the rest split evenly.
    </p>
  </div>   

  <div id="hireDialog" title="Full-time Employment">
    <p> Do you would want to hire Barret full-time as a Front-End Engineer?
    </p>
  </div>   

  <div id="final" title="Final Bill">
    <p> Total: $1,000.
    </p>
  </div>   

  <script src="{{ STATIC_URL }}js/dialog.js"></script>

</body>
</html>